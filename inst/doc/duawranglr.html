<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Data usage agreements and R</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Data usage agreements and R</h1>



<p>The <code>duawranglr</code> package is designed with the idea that rather than setting a new data usage agreement (DUA) for each project in an ongoing collaboration between researchers and data partners, two things will happen instead:</p>
<ol style="list-style-type: decimal">
<li>A master DUA will be signed that establishes a general framework for collaboration alongside multiple levels of data restriction; for each new project, these levels (<em>e.g.</em>, I, II, &amp; III) can then be invoked and used to determine which variables may be shared, with whom, and under what conditions.<br />
</li>
<li>A associated crosswalk file will list the names of data elements that are restricted at each level and be used with this package to easily and clearly transform raw restricted data files into those that can be shared under the conditions of the master DUA.</li>
</ol>
<p>This vignette goes through the process of using <code>duawranglr</code> functions to create a sharable data set from a raw administrative file. Though no two projects are alike, users should generally follow the steps below.</p>
<p><strong>Important upfront caveat:</strong> using <code>duawranglr</code> does not guarantee data security. It goes without saying, but users, of course, can simply <em>not use</em> the package when attempting to secure restricted data. What this package does is offer a framework and a set of useful functions that, when followed, help users secure data in a clear and replicable manner.</p>
<div id="administrative-data" class="section level1">
<h1>Administrative data</h1>
<p>After loading some libraries, weâ€™ll first read in the raw administrative data file and take a look.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(duawranglr)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">## read in raw administrative data</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">'./admin_data.csv'</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">df</a></code></pre></div>
<pre><code># A tibble: 9 x 10
  sid         sname    dob      gender raceeth   tid tname   zip mathscr readscr
  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
1 000-00-0001 Schaefer 19900114      0       2     1 Smith 22906     515     496
2 000-00-0002 Hodges   19900225      0       1     1 Smith 22906     488     489
3 000-00-0003 Kirby    19900305      0       4     1 Smith 22906     522     498
4 000-00-0004 Estrada  19900419      0       3     1 Smith 22906     516     524
5 000-00-0005 Nielsen  19900530      1       2     1 Smith 22906     483     509
6 000-00-0006 Dean     19900621      1       1     2 Brown 22906     503     523
7 000-00-0007 Hickman  19900712      1       1     2 Brown 22906     539     509
8 000-00-0008 Bryant   19900826      0       2     2 Brown 22906     499     490
9 000-00-0009 Lynch    19900902      1       3     2 Brown 22906     499     493</code></pre>
<p>The <code>admin_data.csv</code> file contains observations for 9 students and has 10 variables associated with each observation. Of these, 1 uniquely identifies each student, 6 are associated with the studentâ€™s personal characteristics, 2 with each studentâ€™s teacher, and 2 with the studentâ€™s test scores in reading and math.</p>
<p>Though there is no codebook, it appears that the identifier for each student, <code>sid</code>, may be the studentâ€™s social security number. As researchers interested in test scores, we have no need for this highly protected data element other than for its ability to uniquely identify a student or allow linking to other records. Since we do not need to link to other records at the moment, any unique number or string will work for our purposes. Similarly, we donâ€™t really need the studentâ€™s last name.</p>
<p>Besides math (<code>mathscr</code>) and reading (<code>readscr</code>) scores, we may be interested in some of the other covariates. Itâ€™s likely that many of these data elements, however, also carry restrictions of varying severity. For example, the school may be able to share the studentâ€™s race/ethnicity and gender (provided the student is not otherwise identified) with most approved researchers, but can only share teachersâ€™ names (<code>tid</code>) under more tightly restricted scenarios.</p>
<p>This is where our DUA crosswalk file comes in handy.</p>
</div>
<div id="data-usage-agreement" class="section level1">
<h1>Data usage agreement</h1>
<p>The crosswalk file, <code>dua_cw.csv</code>, for the current DUA looks like this:</p>
<table>
<thead>
<tr class="header">
<th align="center">level_i</th>
<th align="center">level_ii</th>
<th align="center">level_iii</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">sid</td>
<td align="center">sid</td>
<td align="center">sid</td>
</tr>
<tr class="even">
<td align="center">sname</td>
<td align="center">sname</td>
<td align="center">sname</td>
</tr>
<tr class="odd">
<td align="center">dob</td>
<td align="center">dob</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">gender</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="center">raceeth</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">tid</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="center">tname</td>
<td align="center">tname</td>
<td align="center">tname</td>
</tr>
<tr class="even">
<td align="center">zip</td>
<td align="center">zip</td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>Each column represents a level, <code>level_i</code>, <code>level_ii</code>, or <code>level_iii</code>, along with the corresponding data element names that are restricted at that level. The names are arbitrary as far as the package goes, but in conjunction with the master DUA, they have meaning:</p>
<ul>
<li><strong>Level I</strong>: The first level produces data sets that can be shared more widely, but at the cost of losing access to most data elements in the final data set. Only math and reading scores can be shared at this level.</li>
<li><strong>Level II:</strong> The second level has slightly fewer data element restrictions, making it better for more research projects. Data produced at this level likely come with more sharing and storage restrictions than those produced at the first level.</li>
<li><strong>Level III:</strong> The third level has the fewest restrictions: only names and the studentâ€™s id cannot be contained in the final data set. Data produced at this level will have the strongest restrictions on who can use it an how it is stored.</li>
</ul>
<p>The benefit of this level-plus-crosswalk system is two-fold:</p>
<ol style="list-style-type: decimal">
<li>Data element restrictions are clearly defined for each level, which in turn has itâ€™s own clearly defined scope for data storage and sharing. When starting a new project under the scope of the master DUA, researchers and data partners need only to assign it a proper level based on the needs of the analyses.</li>
<li>Because the crosswalk is a simple tabular file, data element names can easily be added or deleted by data partners who do not typically use data analysis software. This helps keep the process transparent for all team members.</li>
</ol>
<div id="set-dua" class="section level2">
<h2>Set DUA</h2>
<p>After reading in the administrative data, the next step is to set the DUA crosswalk file. The crosswalk file can be in many different formats and, in most cases, will be read in automatically no matter the type. (If using a delimited file that isnâ€™t a comma- or tab-separated value format, give the <code>delimiter</code> argument the delimiter string; if using an Excel file with more than one sheet, give the <code>sheet</code> argument the sheet name or number.) If successful, you will get message telling you so.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">## set the DUA crosswalk</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">set_dua_cw</span>(<span class="st">'dua_cw.csv'</span>)</a></code></pre></div>
<pre><code>------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
DUA crosswalk has been set!
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------</code></pre>
</div>
<div id="check-dua-options" class="section level2">
<h2>Check DUA options</h2>
<p>In case youâ€™ve forgotten the data elements that are restricted at a particular level, you can check them using the <code>see_dua_options()</code> function with the <code>level</code> argument set to the appropriate level. If you want to compare restrictions across more than one level, you can give the <code>level</code> argument a vector.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">## compare level II and III restrictions</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">see_dua_options</span>(<span class="dt">level =</span> <span class="kw">c</span>(<span class="st">'level_ii'</span>, <span class="st">'level_iii'</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_ii</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"> </a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_iii</a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb5-20" data-line-number="20"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb5-21" data-line-number="21"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb5-22" data-line-number="22"> </a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
<p>Alternately, you can see restrictions at all levels if you leave the <code>level</code> argument at its default <code>NULL</code> value.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">## check all level restrictions</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">see_dua_options</span>()</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_i</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>gender</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"> <span class="op">-</span><span class="st"> </span>raceeth</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"> <span class="op">-</span><span class="st"> </span>tid</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb6-16" data-line-number="16"> </a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_ii</a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb6-23" data-line-number="23"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb6-24" data-line-number="24"> <span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb6-25" data-line-number="25"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb6-26" data-line-number="26"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb6-27" data-line-number="27"> </a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-29" data-line-number="29">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_iii</a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"></a>
<a class="sourceLine" id="cb6-32" data-line-number="32">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb6-34" data-line-number="34"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb6-35" data-line-number="35"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb6-36" data-line-number="36"> </a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
</div>
<div id="set-dua-level" class="section level2">
<h2>Set DUA level</h2>
<p>After consultation with our data partner, weâ€™ve decided that data for this project need to be set at Level II. Because no level allows us to use the current unique ID, <code>sid</code>, we also need to deidentify the data. We could just delete the <code>sid</code> column, but for reasons discussed below, it will be better if we use it to make new, non-identifiable but unique IDs. Therefore, we use additional arguments in <code>set_dua_level()</code> to note that deidentification is required and set the targeted ID column.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">## set DUA level</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">set_dua_level</span>(<span class="st">'level_ii'</span>, <span class="dt">deidentify_required =</span> <span class="ot">TRUE</span>, <span class="dt">id_column =</span> <span class="st">'sid'</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">Unique IDs <span class="cf">in</span> [ sid ] must be deidentified; use <span class="op">-</span><span class="kw">deid_dua</span>()<span class="op">-</span>.</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
</div>
<div id="check-dua-level" class="section level2">
<h2>Check DUA level</h2>
<p>As weâ€™re preparing the data, we can check our restriction level and the data element names it restricts using <code>see_dua_level()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">## see set DUA level </a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">see_dua_level</span>(<span class="dt">show_restrictions =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">You have set restrictions at [ level_ii ]</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb8-13" data-line-number="13"> </a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
</div>
</div>
<div id="deidentify-data" class="section level1">
<h1>Deidentify data</h1>
<p>So far, we have set the DUA crosswalk as well as the restriction level we will abide by. But our underlying data has not changed at all:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">## show administrative data has not changed</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">df</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co"># A tibble: 9 x 10</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  sid         sname    dob      gender raceeth   tid tname   zip mathscr readscr</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">       </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="dv">1</span> <span class="dv">000-00-0001</span> Schaefer <span class="dv">19900114</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="dv">2</span> <span class="dv">000-00-0002</span> Hodges   <span class="dv">19900225</span>      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="dv">3</span> <span class="dv">000-00-0003</span> Kirby    <span class="dv">19900305</span>      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="dv">4</span> <span class="dv">000-00-0004</span> Estrada  <span class="dv">19900419</span>      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="dv">5</span> <span class="dv">000-00-0005</span> Nielsen  <span class="dv">19900530</span>      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="dv">6</span> <span class="dv">000-00-0006</span> Dean     <span class="dv">19900621</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="dv">7</span> <span class="dv">000-00-0007</span> Hickman  <span class="dv">19900712</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="dv">8</span> <span class="dv">000-00-0008</span> Bryant   <span class="dv">19900826</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="dv">9</span> <span class="dv">000-00-0009</span> Lynch    <span class="dv">19900902</span>      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
<p>We indicated that the data need to be deidentified, so a good first step in cleaning the raw data is to convert unique student id, <code>sid</code>, into a similarly unique, but unidentifiable value.</p>
<p>Why not just generate some random string for each value? Though we donâ€™t care to merge these data with other files, we may need to do so in the future. If we randomly generate new IDs, discarding the old ones in the process, we will be stuck.</p>
<p>The <code>deid_dua()</code> function does two things:</p>
<ol style="list-style-type: decimal">
<li>It uses a secure <code>SHA-2</code> algorithm to convert sensitive IDs into unique hexadecimal strings that are almost impossible back convert;</li>
<li>It has the option to save a crosswalk file that links the old secure IDs to the new IDs.</li>
</ol>
<p>Clearly, it defeats the purpose of deidentifying IDs if a crosswalk between old and new travels with the new data. But if the crosswalk file is keep in a secure location, perhaps on the same server that hosts the raw administrative data, then old IDs can be retrieved if necessary by those with the proper clearance to do so.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">## deidentify data</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">deid_dua</span>(df, <span class="dt">write_crosswalk =</span> <span class="ot">TRUE</span>, <span class="dt">id_length =</span> <span class="dv">20</span>)</a></code></pre></div>
<p>Hereâ€™s what the saved crosswalk looks like:</p>
<pre><code># A tibble: 9 x 2
  sid         id                  
  &lt;chr&gt;       &lt;chr&gt;               
1 000-00-0001 187b33f8482af9d9adeb
2 000-00-0002 46231e11b4cdacb6cd69
3 000-00-0003 7a2cf7b4ae65bd6d06ee
4 000-00-0004 d5d8bfce31a5f70e3ce9
5 000-00-0005 a31445bd544ac80741bf
6 000-00-0006 6e640c0ff2331dbf0928
7 000-00-0007 b3414c249f048fb9c0a8
8 000-00-0008 1c412145ce82079a9516
9 000-00-0009 a5bceb3abd7e63599411</code></pre>
<p>And here now is the data frame:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">## show data frame</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">df</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># A tibble: 9 x 10</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  id                   sname    dob      gender raceeth   tid tname   zip mathscr readscr</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="dv">1</span> 187b33f8482af9d9adeb Schaefer <span class="dv">19900114</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="dv">2</span> <span class="fl">46231e11</span>b4cdacb6cd69 Hodges   <span class="dv">19900225</span>      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="dv">3</span> 7a2cf7b4ae65bd6d06ee Kirby    <span class="dv">19900305</span>      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="dv">4</span> d5d8bfce31a5f70e3ce9 Estrada  <span class="dv">19900419</span>      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="dv">5</span> a31445bd544ac80741bf Nielsen  <span class="dv">19900530</span>      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="dv">6</span> <span class="fl">6e640</span>c0ff2331dbf0928 Dean     <span class="dv">19900621</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="dv">7</span> b3414c249f048fb9c0a8 Hickman  <span class="dv">19900712</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="dv">8</span> 1c412145ce82079a9516 Bryant   <span class="dv">19900826</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="dv">9</span> a5bceb3abd7e63599411 Lynch    <span class="dv">19900902</span>      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
</div>
<div id="check-data-frame" class="section level1">
<h1>Check data frame</h1>
<p>If we try to write the data frame using the <code>write_dua_df()</code> function, we get an error.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">## write data to disk with one last check</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">write_dua_df</span>(df, <span class="st">'cleaned_data.csv'</span>, <span class="dt">output_type =</span> <span class="st">'csv'</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">Data set has not yet passed check. Run <span class="op">-</span><span class="kw">check_dua_restrictions</span>()<span class="op">-</span><span class="st"> </span>to check status.</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
<p>Right, we havenâ€™t removed all the restricted data elements. Following the directions, we can check to see what still needs to be removed using the <code>check_dua_restrictions()</code> function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">## check</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">check_dua_restrictions</span>(df)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">The following variables are not allowed at the current data usage <span class="kw">level</span> (level_ii) and</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">STILL MUST be removed<span class="op">:</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="st"> </span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
<p>Weâ€™ve successfully removed <code>sid</code> already (when we deidentified the data frame), but still have to remove the studentâ€™s last name, date of birth, teacherâ€™s name, and zip code to meet level II restrictions. Once we remove those columns, we can check again.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">## remove restricted columns</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(sname, dob, tname, zip))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">## check again</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="kw">check_dua_restrictions</span>(df)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">Data set has passed check and may be saved.</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
<p>Success! And to be sure, hereâ€™s what our data frame looks like now:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">df</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co"># A tibble: 9 x 6</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  id                   gender raceeth   tid mathscr readscr</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                 </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="dv">1</span> 187b33f8482af9d9adeb      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="dv">2</span> <span class="fl">46231e11</span>b4cdacb6cd69      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="dv">3</span> 7a2cf7b4ae65bd6d06ee      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="dv">4</span> d5d8bfce31a5f70e3ce9      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="dv">5</span> a31445bd544ac80741bf      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="dv">6</span> <span class="fl">6e640</span>c0ff2331dbf0928      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="dv">7</span> b3414c249f048fb9c0a8      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="dv">8</span> 1c412145ce82079a9516      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="dv">9</span> a5bceb3abd7e63599411      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
</div>
<div id="write-cleaned-data-frame-to-disk" class="section level1">
<h1>Write cleaned data frame to disk</h1>
<p>Now that weâ€™ve passed our check, we can write the level II secure data frame to disk. Just like the <code>set_dua_cw()</code> function, which automates reading in many types of files, <code>write_dua_df()</code> will write many types of files. See <code>?write_dua_df</code> for options.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">## write data to disk </a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">write_dua_df</span>(df, <span class="st">'cleaned_data_lev_ii.csv'</span>, <span class="dt">output_type =</span> <span class="st">'csv'</span>)</a></code></pre></div>
</div>
<div id="interactive-template" class="section level1">
<h1>Interactive template</h1>
<p>Particularly for the first few times you use this package, you may need help remembering the steps. To help the process, the interactive <code>make_dua_template()</code> function will help you make a template script that you can then modify to meet your data cleaning needs. When called, the function will ask you a few yes or no questions and, based on your answers, build a template script that pre-fills some function arguments.</p>
<p>An example template script is printed below.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">## save template to disk</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">make_dua_template</span>(<span class="st">'clean_data.R'</span>)</a></code></pre></div>
<div id="example" class="section level4">
<h4>EXAMPLE</h4>
<pre><code>################################################################################
##
## [ Proj ] &lt; general project name &gt;
## [ File ] clean_data.R
## [ Auth ] &lt; author name &gt;
## [ Init ] 18 April 2018
##
################################################################################
 
## ---------------------------
## libraries
## ---------------------------
 
## NOTES: Include additional libraries using either -library()- or -require()-
## functions here.
 
## ---------------------------
## set DUA crosswalk
## ---------------------------
 
## NOTES: Choose the DUA agreement crosswalk file if you didn't when setting up
## the template. If the file is a delimited file that isn't a CSV or TSV, be
## sure to indicate the delimiter string with the -delimiter- argument.
## Similarly if the crosswalk is in an Excel file on any sheet beyond the
## first, set the -sheet- argument to the correct sheet.
 
set_dua(dua = '&lt; dua crosswalk file name &gt;')
 
## ---------------------------
## set DUA level
## ---------------------------
 
## NOTES: Choose the DUA agreement crosswalk level. If you indicated that the
## data should be deidentified, those options, including the ID column if
## choosen, are included below. If you did not indicate the name of the ID
## column to be deidentified, add its name after the -id_column- argument.
## 
## If you did not indicate that the data should be deidentified, but they
## should be, see ?deid_dua().
 
set_dua_level(level = '&lt; level name &gt;')
 
## ---------------------------
## data cleaning
## ---------------------------
 
## NOTES: Use standard scripts to build and clean data set here.
 
## ---------------------------
## check DUA restrictions
## ---------------------------
 
## NOTES: If your data frame includes restricted data elements or should have
## been deidentified and has not been, -check_dua_restrictions()- will return
## an error and stop. Fix above and rerun or set -remove_protected- arguement
## to TRUE to automatically remove restricted columns.
 
check_dua_restrictions(df = '&lt; data frame &gt;')
 
## ---------------------------
## write cleaned file
## ---------------------------
 
## NOTES: Write cleaned file to disk. Select the file type (e.g., CSV, TSV,
## Stata, Rdata) and include additional arguments required by -haven- or base R
## writing functions.
 
write_dua_df(df = '&lt; data frame &gt;', output_type = '&lt; output file type &gt;'
 
## -----------------------------------------------------------------------------
## end script
################################################################################</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
