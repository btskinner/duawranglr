<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Securing data with duawranglr • duawranglr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Securing data with duawranglr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">duawranglr</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.6.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/duawranglr.html">Motivation</a>
</li>
<li>
  <a href="../articles/securing_data.html">Example usage</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="https://github.com/btskinner/duawranglr">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
<li>
  <a href="https://twitter.com/btskinner">
    <span class="fab fa fab fa-twitter"></span>
     
    twitter
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Securing data with duawranglr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/btskinner/duawranglr/blob/master/vignettes/securing_data.Rmd"><code>vignettes/securing_data.Rmd</code></a></small>
      <div class="hidden name"><code>securing_data.Rmd</code></div>

    </div>

    
    
<p>This vignette walks through the process for using duawranglr. It assumes that the data administrator and researcher have executed a data usage agreement (DUA) with three potential levels of data restrictions and created a crosswalk spreadsheet in Excel.</p>
<div id="administrative-file-to-be-wrangled" class="section level2">
<h2 class="hasAnchor">
<a href="#administrative-file-to-be-wrangled" class="anchor"></a>Administrative file to be wrangled</h2>
<p>The raw administrative data file that needs to be processed looks like this:</p>
<table class="table">
<thead><tr class="header">
<th align="center">sid</th>
<th align="center">sname</th>
<th align="center">dob</th>
<th align="center">gender</th>
<th align="center">raceeth</th>
<th align="center">tid</th>
<th align="center">tname</th>
<th align="center">zip</th>
<th align="center">mathscr</th>
<th align="center">readscr</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">000-00-0001</td>
<td align="center">Schaefer</td>
<td align="center">19900114</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">Smith</td>
<td align="center">22906</td>
<td align="center">515</td>
<td align="center">496</td>
</tr>
<tr class="even">
<td align="center">000-00-0002</td>
<td align="center">Hodges</td>
<td align="center">19900225</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">Smith</td>
<td align="center">22906</td>
<td align="center">488</td>
<td align="center">489</td>
</tr>
<tr class="odd">
<td align="center">000-00-0003</td>
<td align="center">Kirby</td>
<td align="center">19900305</td>
<td align="center">0</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">Smith</td>
<td align="center">22906</td>
<td align="center">522</td>
<td align="center">498</td>
</tr>
<tr class="even">
<td align="center">000-00-0004</td>
<td align="center">Estrada</td>
<td align="center">19900419</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">Smith</td>
<td align="center">22906</td>
<td align="center">516</td>
<td align="center">524</td>
</tr>
<tr class="odd">
<td align="center">000-00-0005</td>
<td align="center">Nielsen</td>
<td align="center">19900530</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">Smith</td>
<td align="center">22906</td>
<td align="center">483</td>
<td align="center">509</td>
</tr>
<tr class="even">
<td align="center">000-00-0006</td>
<td align="center">Dean</td>
<td align="center">19900621</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">Brown</td>
<td align="center">22906</td>
<td align="center">503</td>
<td align="center">523</td>
</tr>
<tr class="odd">
<td align="center">000-00-0007</td>
<td align="center">Hickman</td>
<td align="center">19900712</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">Brown</td>
<td align="center">22906</td>
<td align="center">539</td>
<td align="center">509</td>
</tr>
<tr class="even">
<td align="center">000-00-0008</td>
<td align="center">Bryant</td>
<td align="center">19900826</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">Brown</td>
<td align="center">22906</td>
<td align="center">499</td>
<td align="center">490</td>
</tr>
<tr class="odd">
<td align="center">000-00-0009</td>
<td align="center">Lynch</td>
<td align="center">19900902</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">Brown</td>
<td align="center">22906</td>
<td align="center">499</td>
<td align="center">493</td>
</tr>
</tbody>
</table>
<p>And we have a codebook:</p>
<ul>
<li>
<code>sid</code>: Student social security number<br>
</li>
<li>
<code>sname</code>: Student’s last name<br>
</li>
<li>
<code>dob</code>: Student’s date of birth<br>
</li>
<li>
<code>gender</code>: Indicator for student gender identification<br>
</li>
<li>
<code>raceeth</code>: Factor variable indicatings student’s racial/ethnic identification<br>
</li>
<li>
<code>tid</code>: ID variable for student’s teacher<br>
</li>
<li>
<code>tname</code>: Last name of student’s teacher<br>
</li>
<li>
<code>zip</code>: Student’s home address zip code<br>
</li>
<li>
<code>mathscr</code>: Student’s end-of-year test math score<br>
</li>
<li>
<code>readscr</code>: Student’s end-of-year test reading score</li>
</ul>
<p>The <code>admin_data.csv</code> file contains observations for 9 students and has 10 variables associated with each observation. Of these, 1 uniquely identifies each student, 6 are associated with the student’s personal characteristics, 2 with each student’s teacher, and 2 with the student’s test scores in reading and math.</p>
<p>It appears that the school uses the student’s social security number to uniquely identify each student. As researchers interested in test scores, we have no need for this highly protected data element other than for its ability to uniquely identify a student or allow linking to other records. Since we do not need to link to other records at the moment, any unique number or string will work for our purposes. Similarly, we don’t really need the student’s last name.</p>
<p>Besides math (<code>mathscr</code>) and reading (<code>readscr</code>) scores, we may be interested in some of the other covariates. It’s likely that many of these data elements, however, also carry restrictions of varying severity. For example, the school may be able to share the student’s race/ethnicity and gender (provided the student is not otherwise identified) with most approved researchers, but can only share teachers’ names (<code>tid</code>) under more tightly restricted scenarios.</p>
<p>This is where our DUA crosswalk file comes in handy.</p>
</div>
<div id="set-dua" class="section level2">
<h2 class="hasAnchor">
<a href="#set-dua" class="anchor"></a>Set DUA</h2>
<p>The first step in the process is to set the DUA crosswalk file. The crosswalk file can be in many different formats and, in most cases, will be read in automatically no matter the type. (If using a delimited file that isn’t a comma- or tab-separated value format, give the <code>delimiter</code> argument the delimiter string; if using an Excel file with more than one sheet, give the <code>sheet</code> argument the sheet name or number.) If successful, you will get message telling you so.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(duawranglr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">## get crosswalk and admin data files</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">dua_cw_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'dua_cw.csv'</span>, <span class="dt">package =</span> <span class="st">'duawranglr'</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">admin_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'admin_data.csv'</span>, <span class="dt">package =</span> <span class="st">'duawranglr'</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">## set the DUA crosswalk</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="../reference/set_dua_cw.html">set_dua_cw</a></span>(dua_cw_file)</a></code></pre></div>
<pre><code>-- duawranglr note -----------------------------------------------------------------------
DUA crosswalk has been set!</code></pre>
</div>
<div id="check-dua-options" class="section level2">
<h2 class="hasAnchor">
<a href="#check-dua-options" class="anchor"></a>Check DUA options</h2>
<p>In case you’ve forgotten the data elements that are restricted at a particular level, you can check them using the <code><a href="../reference/see_dua_options.html">see_dua_options()</a></code> function with the <code>level</code> argument set to the appropriate level. If you want to compare restrictions across more than one level, you can give the <code>level</code> argument a vector.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">## compare level II and III restrictions</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="../reference/see_dua_options.html">see_dua_options</a></span>(<span class="dt">level =</span> <span class="kw">c</span>(<span class="st">'level_ii'</span>, <span class="st">'level_iii'</span>))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_ii</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"> </a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_iii</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb3-20" data-line-number="20"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb3-21" data-line-number="21"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb3-22" data-line-number="22"> </a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
<p>Alternately, you can see restrictions at all levels if you leave the <code>level</code> argument at its default <code>NULL</code> value.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## check all level restrictions</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="../reference/see_dua_options.html">see_dua_options</a></span>()</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_i</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>gender</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>raceeth</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"> <span class="op">-</span><span class="st"> </span>tid</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"> </a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_ii</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"></a>
<a class="sourceLine" id="cb4-21" data-line-number="21">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="st"> </span><span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb4-23" data-line-number="23"> <span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb4-24" data-line-number="24"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb4-25" data-line-number="25"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb4-26" data-line-number="26"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb4-27" data-line-number="27"> </a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29">LEVEL NAME<span class="op">:</span><span class="st"> </span>level_iii</a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"></a>
<a class="sourceLine" id="cb4-32" data-line-number="32">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb4-34" data-line-number="34"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb4-35" data-line-number="35"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb4-36" data-line-number="36"> </a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
</div>
<div id="set-dua-level" class="section level2">
<h2 class="hasAnchor">
<a href="#set-dua-level" class="anchor"></a>Set DUA level</h2>
<p>After consultation with our data partner, we’ve decided that data for this project need to be set at Level II. Because no level allows us to use the current unique ID, <code>sid</code>, we also need to deidentify the data. We could just delete the <code>sid</code> column, but for reasons discussed below, it will be better if we use it to make new, non-identifiable but unique IDs. Therefore, we use additional arguments in <code><a href="../reference/set_dua_level.html">set_dua_level()</a></code> to note that deidentification is required and set the targeted ID column.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## set DUA level</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="../reference/set_dua_level.html">set_dua_level</a></span>(<span class="st">'level_ii'</span>, <span class="dt">deidentify_required =</span> <span class="ot">TRUE</span>, <span class="dt">id_column =</span> <span class="st">'sid'</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="op">--</span><span class="st"> </span>duawranglr note <span class="op">-----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">Unique IDs <span class="cf">in</span> [ sid ] must be deidentified; use <span class="op">-</span><span class="kw"><a href="../reference/deid_dua.html">deid_dua</a></span>()<span class="op">-</span>.</a></code></pre></div>
</div>
<div id="check-dua-level" class="section level2">
<h2 class="hasAnchor">
<a href="#check-dua-level" class="anchor"></a>Check DUA level</h2>
<p>As we’re preparing the data, we can check our restriction level and the data element names it restricts using <code><a href="../reference/see_dua_level.html">see_dua_level()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">## see set DUA level </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="../reference/see_dua_level.html">see_dua_level</a></span>(<span class="dt">show_restrictions =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">You have set restrictions at [ level_ii ]</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="op">------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">RESTRICTED VARIABLE NAMES<span class="op">:</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st"> </span><span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>sid</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"> <span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"> <span class="op">-</span><span class="st"> </span>zip</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"> </a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="op">------------------------------------------------------------------------------------------</span></a></code></pre></div>
</div>
<div id="administrative-data" class="section level1">
<h1 class="hasAnchor">
<a href="#administrative-data" class="anchor"></a>Administrative data</h1>
<p>After loading some libraries, we’ll first read in the raw administrative data file and confirm that it has nine observations and the data elements we expect.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">## read in raw administrative data</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_dua_file.html">read_dua_file</a></span>(admin_file)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">df</a></code></pre></div>
<pre><code># A tibble: 9 x 10
  sid         sname    dob      gender raceeth   tid tname   zip mathscr readscr
  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
1 000-00-0001 Schaefer 19900114      0       2     1 Smith 22906     515     496
2 000-00-0002 Hodges   19900225      0       1     1 Smith 22906     488     489
3 000-00-0003 Kirby    19900305      0       4     1 Smith 22906     522     498
4 000-00-0004 Estrada  19900419      0       3     1 Smith 22906     516     524
5 000-00-0005 Nielsen  19900530      1       2     1 Smith 22906     483     509
6 000-00-0006 Dean     19900621      1       1     2 Brown 22906     503     523
7 000-00-0007 Hickman  19900712      1       1     2 Brown 22906     539     509
8 000-00-0008 Bryant   19900826      0       2     2 Brown 22906     499     490
9 000-00-0009 Lynch    19900902      1       3     2 Brown 22906     499     493</code></pre>
</div>
<div id="deidentify-data" class="section level1">
<h1 class="hasAnchor">
<a href="#deidentify-data" class="anchor"></a>Deidentify data</h1>
<div id="single-file-or-no-existing-crosswalk" class="section level2">
<h2 class="hasAnchor">
<a href="#single-file-or-no-existing-crosswalk" class="anchor"></a>Single file or no existing crosswalk</h2>
<p>We indicated that the data need to be deidentified, so a good first step in cleaning the raw data is to convert unique student id, <code>sid</code>, into a similarly unique, but unidentifiable value.</p>
<p>Why not just generate some random string for each value? Though we don’t care to merge these data with other files, we may need to do so in the future. If we randomly generate new IDs, discarding the old ones in the process, we will be stuck.</p>
<p>The <code><a href="../reference/deid_dua.html">deid_dua()</a></code> function does two things:</p>
<ol style="list-style-type: decimal">
<li>It uses a secure <code>SHA-2</code> algorithm to convert sensitive IDs into unique hexadecimal strings that cannot be reverted back to the originial IDs (important in the case such as ours when the unique ID is the student’s social security number);</li>
<li>It has the option to save a crosswalk file that links the old secure IDs to the new IDs.</li>
</ol>
<p>Clearly, it defeats the purpose of deidentifying IDs if a crosswalk between old and new travels with the new data. But if the crosswalk file is keep in a secure location, perhaps on the same server that hosts the raw administrative data, then old IDs can be retrieved if necessary by those with the proper clearance to do so.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">## deidentify data</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/deid_dua.html">deid_dua</a></span>(df, <span class="dt">write_crosswalk =</span> <span class="ot">TRUE</span>, <span class="dt">id_length =</span> <span class="dv">20</span>)</a></code></pre></div>
<p>Here’s what the saved crosswalk looks like:</p>
<pre><code># A tibble: 9 x 2
  sid         id                  
  &lt;chr&gt;       &lt;chr&gt;               
1 000-00-0001 c8c87fa815228e6be62c
2 000-00-0002 d14bd96d54a2a4473b35
3 000-00-0003 346be306b9a650698425
4 000-00-0004 2e659892b6b0672eaa15
5 000-00-0005 253726179a165b444d0e
6 000-00-0006 7dbbb565cdfeeefe630a
7 000-00-0007 ab43695e2930b7467670
8 000-00-0008 6688e95e1feb7411c196
9 000-00-0009 a2416f3f12cf27969975</code></pre>
<p>And here now is the data frame:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">## show data frame</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">df</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># A tibble: 9 x 10</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  id                   sname    dob      gender raceeth   tid tname   zip mathscr readscr</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="dv">1</span> c8c87fa815228e6be62c Schaefer <span class="dv">19900114</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="dv">2</span> d14bd96d54a2a4473b35 Hodges   <span class="dv">19900225</span>      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="dv">3</span> 346be306b9a650698425 Kirby    <span class="dv">19900305</span>      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="dv">4</span> <span class="fl">2e659892</span>b6b0672eaa15 Estrada  <span class="dv">19900419</span>      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="dv">5</span> 253726179a165b444d0e Nielsen  <span class="dv">19900530</span>      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="dv">6</span> 7dbbb565cdfeeefe630a Dean     <span class="dv">19900621</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="dv">7</span> ab43695e2930b7467670 Hickman  <span class="dv">19900712</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="dv">8</span> <span class="fl">6688e95</span>e1feb7411c196 Bryant   <span class="dv">19900826</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="dv">9</span> a2416f3f12cf27969975 Lynch    <span class="dv">19900902</span>      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
</div>
<div id="links-across-multiple-files-with-existing-crosswalk" class="section level2">
<h2 class="hasAnchor">
<a href="#links-across-multiple-files-with-existing-crosswalk" class="anchor"></a>Links across multiple files with existing crosswalk</h2>
<p>If the deidentified data frame is built from multiple files (<em>e.g.</em>, a panel data set of observations across years), then we’ll want to reuse an existing crosswalk. Otherwise, the same original ID will end up with multiple new IDs and we won’t be able to link observations across data sets.</p>
<p>Let’s say we already have master crosswalk file that looks like this:</p>
<pre><code># A tibble: 9 x 2
  sid         id                  
  &lt;chr&gt;       &lt;chr&gt;               
1 000-00-0001 db3681caa7e4789c9a99
2 000-00-0002 8e13af4fbb998c26348f
3 000-00-0003 2c7f2f98f9ee0e3b69ba
4 000-00-0004 ed7041ab2076a84fe611
5 000-00-0005 d4180e00af840a7a8e29
6 000-00-0006 9d42b365e2e49989b620
7 000-00-0007 a997bd9ffc4ee8030081
8 000-00-0008 43fc27899df21721b0c5
9 000-00-0009 e3150a7010e9a08d52f0</code></pre>
<p>Rather than create new IDs, we can use the <code>existing_crosswalk</code> argument to read in and use the new IDs we’ve already made. Everything else works the same as before.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/deid_dua.html">deid_dua</a></span>(df, <span class="dt">existing_crosswalk =</span> <span class="st">'master_crosswalk.csv'</span>)</a></code></pre></div>
<p>The new ID values now match those from the crosswalk.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">df</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co"># A tibble: 9 x 10</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  id                   sname    dob      gender raceeth   tid tname   zip mathscr readscr</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="dv">1</span> db3681caa7e4789c9a99 Schaefer <span class="dv">19900114</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="dv">2</span> <span class="fl">8e13</span>af4fbb998c26348f Hodges   <span class="dv">19900225</span>      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="dv">3</span> 2c7f2f98f9ee0e3b69ba Kirby    <span class="dv">19900305</span>      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="dv">4</span> ed7041ab2076a84fe611 Estrada  <span class="dv">19900419</span>      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="dv">5</span> d4180e00af840a7a8e29 Nielsen  <span class="dv">19900530</span>      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="dv">6</span> 9d42b365e2e49989b620 Dean     <span class="dv">19900621</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="dv">7</span> a997bd9ffc4ee8030081 Hickman  <span class="dv">19900712</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="dv">8</span> 43fc27899df21721b0c5 Bryant   <span class="dv">19900826</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="dv">9</span> e3150a7010e9a08d52f0 Lynch    <span class="dv">19900902</span>      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
</div>
<div id="updates-to-existing-crosswalk" class="section level2">
<h2 class="hasAnchor">
<a href="#updates-to-existing-crosswalk" class="anchor"></a>Updates to existing crosswalk</h2>
<p>In our example, we have nine students in the current file. Let’s say that though we have a crosswalk, it only has new IDs for the first five observations:</p>
<pre><code># A tibble: 5 x 2
  sid         id                  
  &lt;chr&gt;       &lt;chr&gt;               
1 000-00-0001 db3681caa7e4789c9a99
2 000-00-0002 8e13af4fbb998c26348f
3 000-00-0003 2c7f2f98f9ee0e3b69ba
4 000-00-0004 ed7041ab2076a84fe611
5 000-00-0005 d4180e00af840a7a8e29</code></pre>
<p>If the existing crosswalk doesn’t have values for all observations, then <code><a href="../reference/deid_dua.html">deid_dua()</a></code> will:</p>
<ol style="list-style-type: decimal">
<li>Match old IDs with new IDs that <strong>do</strong> exist in the crosswalk</li>
<li>Generate new IDs for the old IDs that <strong>don’t</strong> exist in the crosswalk</li>
<li>Update and save the crosswalk</li>
</ol>
<p>The command is the same for a partial crosswalk as for a complete crosswalk.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/deid_dua.html">deid_dua</a></span>(df, <span class="dt">existing_crosswalk =</span> <span class="st">'crosswalk_partial.csv'</span>)</a></code></pre></div>
<p>Notice that the new IDs for the first five observations match those that were already in the existing crosswalk. The last four are new.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">df</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co"># A tibble: 9 x 10</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  id                   sname    dob      gender raceeth   tid tname   zip mathscr readscr</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="dv">1</span> db3681caa7e4789c9a99 Schaefer <span class="dv">19900114</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="dv">2</span> <span class="fl">8e13</span>af4fbb998c26348f Hodges   <span class="dv">19900225</span>      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="dv">3</span> 2c7f2f98f9ee0e3b69ba Kirby    <span class="dv">19900305</span>      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="dv">4</span> ed7041ab2076a84fe611 Estrada  <span class="dv">19900419</span>      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="dv">5</span> d4180e00af840a7a8e29 Nielsen  <span class="dv">19900530</span>      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span> Smith <span class="dv">22906</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="dv">6</span> b95b97f0d3a3921c9b77 Dean     <span class="dv">19900621</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="dv">7</span> b9e6390091651b4e57c2 Hickman  <span class="dv">19900712</span>      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="dv">8</span> <span class="fl">1e43</span>c6e587bb8a8fd75d Bryant   <span class="dv">19900826</span>      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="dv">9</span> b18cd8114eed1a67d7ef Lynch    <span class="dv">19900902</span>      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span> Brown <span class="dv">22906</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
<p>Looking at the partial crosswalk, we see that it now has four new rows with new IDs each for the observations it didn’t have before.</p>
<pre><code># A tibble: 9 x 2
  sid         id                  
  &lt;chr&gt;       &lt;chr&gt;               
1 000-00-0001 db3681caa7e4789c9a99
2 000-00-0002 8e13af4fbb998c26348f
3 000-00-0003 2c7f2f98f9ee0e3b69ba
4 000-00-0004 ed7041ab2076a84fe611
5 000-00-0005 d4180e00af840a7a8e29
6 000-00-0006 b95b97f0d3a3921c9b77
7 000-00-0007 b9e6390091651b4e57c2
8 000-00-0008 1e43c6e587bb8a8fd75d
9 000-00-0009 b18cd8114eed1a67d7ef</code></pre>
<p>Should we encounter those students in future files, <code><a href="../reference/deid_dua.html">deid_dua()</a></code> will use the new IDs we just created.</p>
</div>
</div>
<div id="check-data-frame" class="section level1">
<h1 class="hasAnchor">
<a href="#check-data-frame" class="anchor"></a>Check data frame</h1>
<p>If we try to write the data frame using the <code><a href="../reference/write_dua_df.html">write_dua_df()</a></code> function, we get an error.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">## write data to disk with one last check</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="../reference/write_dua_df.html">write_dua_df</a></span>(df, <span class="st">'cleaned_data.csv'</span>, <span class="dt">output_type =</span> <span class="st">'csv'</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="op">--</span><span class="st"> </span>duawranglr note <span class="op">-----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">Data set has not yet passed check. Run <span class="op">-</span><span class="kw"><a href="../reference/check_dua_restrictions.html">check_dua_restrictions</a></span>()<span class="op">-</span><span class="st"> </span>to check status.</a></code></pre></div>
<p>Right, we haven’t removed all the restricted data elements. Following the directions, we can check to see what still needs to be removed using the <code><a href="../reference/check_dua_restrictions.html">check_dua_restrictions()</a></code> function.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">## check</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw"><a href="../reference/check_dua_restrictions.html">check_dua_restrictions</a></span>(df)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="op">--</span><span class="st"> </span>duawranglr note <span class="op">-----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">The following variables are not allowed at the current data usage level restriction [</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">level_ii ] and MUST BE REMOVED before saving<span class="op">:</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st"> </span><span class="op">-</span><span class="st"> </span>sname</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"> <span class="op">-</span><span class="st"> </span>dob</a>
<a class="sourceLine" id="cb20-8" data-line-number="8"> <span class="op">-</span><span class="st"> </span>tname</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"> <span class="op">-</span><span class="st"> </span>zip</a></code></pre></div>
<p>We’ve successfully removed <code>sid</code> already (when we deidentified the data frame), but still have to remove the student’s last name, date of birth, teacher’s name, and zip code to meet level II restrictions. Once we remove those columns, we can check again.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">## remove restricted columns</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(sname, dob, tname, zip))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">## check again</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw"><a href="../reference/check_dua_restrictions.html">check_dua_restrictions</a></span>(df)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="op">--</span><span class="st"> </span>duawranglr note <span class="op">-----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">Data set has passed check and may be saved.</a></code></pre></div>
<p>Success! And to be sure, here’s what our data frame looks like now:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">df</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co"># A tibble: 9 x 6</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">  id                   gender raceeth   tid mathscr readscr</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                 </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="dv">1</span> db3681caa7e4789c9a99      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">1</span>     <span class="dv">515</span>     <span class="dv">496</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="dv">2</span> <span class="fl">8e13</span>af4fbb998c26348f      <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">488</span>     <span class="dv">489</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="dv">3</span> 2c7f2f98f9ee0e3b69ba      <span class="dv">0</span>       <span class="dv">4</span>     <span class="dv">1</span>     <span class="dv">522</span>     <span class="dv">498</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="dv">4</span> ed7041ab2076a84fe611      <span class="dv">0</span>       <span class="dv">3</span>     <span class="dv">1</span>     <span class="dv">516</span>     <span class="dv">524</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="dv">5</span> d4180e00af840a7a8e29      <span class="dv">1</span>       <span class="dv">2</span>     <span class="dv">1</span>     <span class="dv">483</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="dv">6</span> b95b97f0d3a3921c9b77      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">503</span>     <span class="dv">523</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="dv">7</span> b9e6390091651b4e57c2      <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">539</span>     <span class="dv">509</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="dv">8</span> <span class="fl">1e43</span>c6e587bb8a8fd75d      <span class="dv">0</span>       <span class="dv">2</span>     <span class="dv">2</span>     <span class="dv">499</span>     <span class="dv">490</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="dv">9</span> b18cd8114eed1a67d7ef      <span class="dv">1</span>       <span class="dv">3</span>     <span class="dv">2</span>     <span class="dv">499</span>     <span class="dv">493</span></a></code></pre></div>
</div>
<div id="write-cleaned-data-frame-to-disk" class="section level1">
<h1 class="hasAnchor">
<a href="#write-cleaned-data-frame-to-disk" class="anchor"></a>Write cleaned data frame to disk</h1>
<p>Now that we’ve passed our check, we can write the level II secure data frame to disk. Just like the <code><a href="../reference/set_dua_cw.html">set_dua_cw()</a></code> function, which automates reading in many types of files, <code><a href="../reference/write_dua_df.html">write_dua_df()</a></code> will write many types of files. See <code><a href="../reference/write_dua_df.html">?write_dua_df</a></code> for options.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co">## write data to disk </span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="../reference/write_dua_df.html">write_dua_df</a></span>(df, <span class="st">'cleaned_data_lev_ii.csv'</span>, <span class="dt">output_type =</span> <span class="st">'csv'</span>)</a></code></pre></div>
</div>
<div id="interactive-template" class="section level1">
<h1 class="hasAnchor">
<a href="#interactive-template" class="anchor"></a>Interactive template</h1>
<p>Particularly for the first few times you use this package, you may need help remembering the steps. To help the process, the interactive <code><a href="../reference/make_dua_template.html">make_dua_template()</a></code> function will help you make a template script that you can then modify to meet your data cleaning needs. When called, the function will ask you a few yes or no questions and, based on your answers, build a template script that pre-fills some function arguments.</p>
<p>An example template script is printed below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co">## save template to disk</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw"><a href="../reference/make_dua_template.html">make_dua_template</a></span>(<span class="st">'clean_data.R'</span>)</a></code></pre></div>
<div id="example" class="section level4">
<h4 class="hasAnchor">
<a href="#example" class="anchor"></a>EXAMPLE</h4>
<pre><code>################################################################################
##
## [ Proj ] &lt; general project name &gt;
## [ File ] clean_data.R
## [ Auth ] &lt; author name &gt;
## [ Init ] 07 September 2018
##
################################################################################
 
## ---------------------------
## libraries
## ---------------------------
 
## NOTES: Include additional libraries using either -library()- or -require()-
## functions here.
 
## ---------------------------
## set DUA crosswalk
## ---------------------------
 
## NOTES: Choose the DUA agreement crosswalk file if you didn't when setting up
## the template. If the file is a delimited file that isn't a CSV or TSV, be
## sure to indicate the delimiter string with the -delimiter- argument.
## Similarly if the crosswalk is in an Excel file on any sheet beyond the
## first, set the -sheet- argument to the correct sheet.
 
set_dua(dua = '&lt; dua crosswalk file name &gt;')
 
## ---------------------------
## set DUA level
## ---------------------------
 
## NOTES: Choose the DUA agreement crosswalk level. If you indicated that the
## data should be deidentified, those options, including the ID column if
## choosen, are included below. If you did not indicate the name of the ID
## column to be deidentified, add its name after the -id_column- argument.
## 
## If you did not indicate that the data should be deidentified, but they
## should be, see ?deid_dua().
 
set_dua_level(level = '&lt; level name &gt;')
 
## ---------------------------
## data cleaning
## ---------------------------
 
## NOTES: Use standard scripts to build and clean data set here.
 
## ---------------------------
## check DUA restrictions
## ---------------------------
 
## NOTES: If your data frame includes restricted data elements or should have
## been deidentified and has not been, -check_dua_restrictions()- will return
## an error and stop. Fix above and rerun or set -remove_protected- arguement
## to TRUE to automatically remove restricted columns.
 
check_dua_restrictions(df = '&lt; data frame &gt;')
 
## ---------------------------
## write cleaned file
## ---------------------------
 
## NOTES: Write cleaned file to disk. Select the file type (e.g., CSV, TSV,
## Stata, Rdata) and include additional arguments required by -haven- or base R
## writing functions.
 
write_dua_df(df = '&lt; data frame &gt;', output_type = '&lt; output file type &gt;'
 
## -----------------------------------------------------------------------------
## end script
################################################################################</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#administrative-file-to-be-wrangled">Administrative file to be wrangled</a></li>
      <li><a href="#set-dua">Set DUA</a></li>
      <li><a href="#check-dua-options">Check DUA options</a></li>
      <li><a href="#set-dua-level">Set DUA level</a></li>
      <li><a href="#check-dua-level">Check DUA level</a></li>
      <li><a href="#administrative-data">Administrative data</a></li>
      <li>
<a href="#deidentify-data">Deidentify data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#single-file-or-no-existing-crosswalk">Single file or no existing crosswalk</a></li>
      <li><a href="#links-across-multiple-files-with-existing-crosswalk">Links across multiple files with existing crosswalk</a></li>
      <li><a href="#updates-to-existing-crosswalk">Updates to existing crosswalk</a></li>
      </ul>
</li>
      <li><a href="#check-data-frame">Check data frame</a></li>
      <li><a href="#write-cleaned-data-frame-to-disk">Write cleaned data frame to disk</a></li>
      <li><a href="#interactive-template">Interactive template</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.btskinner.me">Benjamin Skinner</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
